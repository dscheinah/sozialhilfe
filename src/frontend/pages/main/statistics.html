<template>
  <h2>Statistik</h2>
  <h3>Staat</h3>
  <table class="main-statistics-table">
    <tr>
      <th>Stufe</th>
      <td id="main-statistics-pool-level"></td>
    </tr>
    <tr>
      <th>Karten</th>
      <td id="main-statistics-pool-cards"></td>
    </tr>
    <tr>
      <th>Wert</th>
      <td id="main-statistics-pool-average"></td>
    </tr>
  </table>
  <h3>Spieler</h3>
  <table class="main-statistics-table">
    <tr>
      <th>aktiv</th>
      <td><span id="main-statistics-players-active"></span><span id="main-statistics-players-ai"></span></td>
    </tr>
    <tr>
      <th>schlafend</th>
      <td id="main-statistics-players-inactive"></td>
    </tr>
  </table>
</template>

<script>
    import {helper, state} from '../../js/lib/sx.js';
    import {cards} from '../../js/mapping.js';

    const apply = (statistics) => {
        if (!statistics) {
            return;
        }
        helper.set('#main-statistics-players-active', 'innerText', statistics.players.active - statistics.players.ai);
        if (statistics.players.ai) {
            helper.set('#main-statistics-players-ai', 'innerText', '+' + statistics.players.ai);
        } else {
            helper.set('#main-statistics-players-ai', 'innerText', '');
        }
        helper.set('#main-statistics-players-inactive', 'innerText', statistics.players.inactive);
        helper.set('#main-statistics-pool-level', 'innerText', statistics.pool.level);
        helper.set('#main-statistics-pool-cards', 'innerText', statistics.pool.cards);
        let mappedCard = cards[statistics.pool.average];
        if (statistics.pool.cards > 1) {
            mappedCard = '~' + mappedCard;
        }
        helper.set('#main-statistics-pool-average', 'innerText', mappedCard);
    };
    state.listen('statistics', statistics => apply(statistics));
    state.handle('sx-show-main', (data, next) => {
        apply(state.get('statistics'));
        return next(data);
    });
</script>

<style>
  .main-statistics-table th {
    min-width: 90px;
  }
</style>
